---
phase: 01-quick-fix-ux
task: complete
total_tasks: 3
status: phase_1_complete_starting_phase_2
last_updated: 2026-02-27T02:22:17.027Z
---

<current_state>
Phase 1 (Quick Fix UX) is COMPLETE with additional fixes beyond the original plan. Phase 2 planning was just initiated but context ran out before research/planning could spawn. User wants Phase 2 AND Phase 3 done in this session.
</current_state>

<completed_work>

## Phase 1: Quick Fix UX (COMPLETE)

- Task 1: Record local fix history entries — Done (recordLocalFixHistoryEntry, applyRuleBasedFixes returns String?)
- Task 2: QuickFixDiffPopupController + wiring — Done (popup class, showQuickFixDiffPopup, widgetFrame accessor)
- Task 3: Human verification — Done (user verified all scenarios work)

## Additional Fixes (post-plan, same session)

- **Live feedback path wired**: applyAllFixes() now returns (original, fixed)? tuple; handleLocalFixHotkey live feedback branch calls recordLocalFixHistoryEntry + showQuickFixDiffPopup
- **Undo for local fixes**: undoLastCorrectionAction checks entry.provider == "Local" and uses kAXValueAttribute to replace full field content instead of replaceSelectedText
- **NSObject inheritance**: QuickFixDiffPopupController inherits from NSObject (required for @objc/selector)
- **Configurable diff preview duration**: New diffPreviewDuration field in AppConfig (1-30 seconds, default 3), settings UI field in Behavior > Correction, QuickFixDiffPopupController.show() accepts duration parameter
- **LLM diff preview**: cmd+shift+E now shows diff popup after correction succeeds (non-streaming AX path, streaming AX path, pasteViaClipboard path all wired via pendingDiffOriginalText property)
- **Foundation Model refusal detection**: Detects "I'm sorry" / "I cannot" responses from Apple Intelligence and falls back to Harper+NSSpellChecker
- **Focus restoration**: targetApp.activate(options: []) added after all local fix paths (Foundation Model success, fallback, direct rule-based)
- **README updated**: Apple Intelligence requirements section, dual hotkey comparison table, diffPreviewDuration in config docs
</completed_work>

<remaining_work>

## Phase 2: Text Selection Fixes (NOT STARTED)
- SEL-01: Notes app cursor-line-only fix (cmd+E fixes only cursor line, not entire page)
- SEL-02: Incompatible apps end-of-field cursor (cursor moves to end after correction, not start)
- Needs: research, planning, execution, verification

## Phase 3: Transparency (NOT STARTED)
- SET-01: Settings comparison table (local vs LLM capabilities)
- SET-02: Apple Intelligence availability display in settings
- DOC-01: README SEO-optimized showcase update
- Needs: research, planning, execution, verification
</remaining_work>

<decisions_made>

- applyAllFixes returns (original: String, fixed: String)? tuple for caller to record history/show popup
- pendingDiffOriginalText property on AppDelegate carries original text through async LLM correction flow, cleared in finishProcessing()
- showDiffPopupForCorrection helper queries focused AX element by PID for popup positioning
- Foundation Model refusal detected by prefix matching ("I'm sorry", "I cannot", "I can't") or output 3x longer than input
- Apple Intelligence on-device model currently refuses grammar correction prompts on user's M3 Max — falls back to Harper+NSSpellChecker
- diffPreviewDuration stored as Int (seconds) in AppConfig with range 1-30
</decisions_made>

<blockers>
- Apple Intelligence on-device model refuses grammar correction prompt ("I'm sorry, but I cannot assist with that request.") — working around with refusal detection + fallback. This is an Apple limitation, not a GhostEdit bug.
</blockers>

<context>
User wants Phase 2 and Phase 3 executed. Phase 2 init was started (gsd-tools init returned phase_req_ids: SEL-01, SEL-02) but phase_found was false — phase directory needs creation. The plan-phase workflow needs to: create phase dir, run research, spawn planner, verify plans, then execute.

Key files modified in this session:
- GhostEdit/Sources/AppDelegate.swift (all UI/wiring changes)
- GhostEdit/Sources/ConfigManager.swift (diffPreviewDuration field)
- README.md (Apple Intelligence docs)

All tests pass (432+). Build succeeds. App installed and running.
</context>

<next_action>
Resume with: /gsd:plan-phase 2 then /gsd:execute-phase 2, followed by /gsd:plan-phase 3 then /gsd:execute-phase 3. First step is to create the phase 2 directory and run research for Text Selection Fixes.
</next_action>
